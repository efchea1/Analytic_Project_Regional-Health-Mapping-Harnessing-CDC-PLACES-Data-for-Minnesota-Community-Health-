[{"name":"app.R","content":"######### Shiny Dashboard\r\n## Load Packages ---------------------------------------------------------------\r\nlibrary(shiny)\r\nlibrary(readr)\r\nlibrary(ggplot2)\r\nlibrary(kableExtra)\r\nlibrary(dplyr)\r\nlibrary(tidyverse)\r\nlibrary(shinydashboard)\r\nlibrary(shinyjs)\r\n# Does this work?\r\n\r\n\r\n# Load Data -------------------------------------------------------------------\r\n# Minnesota CDC Places Census Estimate data for 2020 to 2022\r\nCensusEstMN <- read.csv(\r\n  'https://raw.githubusercontent.com/quincountychsmn/Public-Data-Sources/main/CDC%20Places/2020%20to%202022%20Pop.%20Estimates/cc-est2022-agesex.csv',\r\n)\r\n\r\n# Minnesota Coronary Heart Disease (CHD) data 2018 to 2021\r\nCHD_files <- list(\r\n  'https://raw.githubusercontent.com/quincountychsmn/Public-Data-Sources/main/CDC%20Places/Places%20CDC%20Estimates/CHD/CHD2018.csv',\r\n  'https://raw.githubusercontent.com/quincountychsmn/Public-Data-Sources/main/CDC%20Places/Places%20CDC%20Estimates/CHD/CHD2019.csv',\r\n  'https://raw.githubusercontent.com/quincountychsmn/Public-Data-Sources/main/CDC%20Places/Places%20CDC%20Estimates/CHD/CHD2020.csv',\r\n  'https://raw.githubusercontent.com/quincountychsmn/Public-Data-Sources/main/CDC%20Places/Places%20CDC%20Estimates/CHD/CHD2021.csv'\r\n)\r\n\r\nCHD_data <- lapply(CHD_files, read.csv)\r\n\r\n# CHB, County\r\nchb_raw <- read.csv(\r\n  'https://raw.githubusercontent.com/quincountychsmn/Public-Data-Sources/main/MN%20SCHSAC%20%26%20CHB%20Regions/Community%20Health%20Board%20as%20of%201_17_2024.csv',\r\n)\r\n\r\n# MN Region\r\nmn_region_raw <- read.csv(\r\n  'https://raw.githubusercontent.com/quincountychsmn/Public-Data-Sources/main/MN%20SCHSAC%20%26%20CHB%20Regions/State%20Community%20Health%20Services%20Advisory%20Committee%20as%20of%201_17_2024.csv',\r\n)\r\n\r\n\r\n# Data Wrangling --------------------------------------------------------------\r\n# Clean and merge CHD data\r\nCHD_data[[1]]$Latitude <- \"NA\"\r\ncolnames(CHD_data[[1]])[colnames(CHD_data[[1]]) == 'Latitude'] <- 'LocationID'\r\ncolnames(CHD_data[[1]])[colnames(CHD_data[[1]]) == 'Geolocatioin'] <- 'Geolocation'\r\nCHD_data <- lapply(CHD_data, function(df) {\r\n  df$LocationID <- as.character(df$LocationID)\r\n  return(df)\r\n})\r\nCHD_Final <- bind_rows(CHD_data)\r\n\r\n\r\n# Filter and select locations\r\nSelected_Locations <- CHD_Final |>\r\n  filter(LocationName %in% c(\"Aitkin\", \"Anoka\", \"Becker\", \"Beltrami\", \"Benton\", \"Big Stone\", \"Blue Earth\", \"Brown\", \"Carlton\", \"Carver\",\r\n                             \"Cass\", \"Chippewa\", \"Chisago\", \"Clay\", \"Clearwater\", \"Cook\", \"Cottonwood\", \"Crow Wing\", \"Dakota\", \"Dodge\", \"Douglas\",\r\n                             \"Faribault\", \"Fillmore\", \"Freeborn\", \"Goodhue\", \"Grant\", \"Hennepin\", \"Houston\", \"Hubbard\", \"Isanti\", \"Itasca\",\r\n                             \"Jackson\", \"Kanabec\", \"Kandiyohi\", \"Kittson\", \"Koochiching\", \"Lac qui Parle\", \"Lake\", \"Lake of the Woods\", \"Le Sueur\",\r\n                             \"Lincoln\", \"Lyon\", \"Mahnomen\", \"Marshall\", \"Martin\", \"McLeod\", \"Meeker\", \"Mille Lacs\", \"Morrison\", \"Mower\", \"Murray\",\r\n                             \"Nicollet\", \"Nobles\", \"Norman\", \"Olmsted\", \"Otter Tail\", \"Pennington\", \"Pine\", \"Pipestone\", \"Polk\", \"Pope\", \"Ramsey\",\r\n                             \"Red Lake\", \"Redwood\", \"Renville\", \"Rice\", \"Rock\", \"Roseau\", \"Scott\", \"Sherburne\", \"Sibley\", \"St. Louis\", \"Stearns\",\r\n                             \"Steele\", \"Stevens\", \"Swift\", \"Todd\", \"Traverse\", \"Wabasha\", \"Wadena\", \"Waseca\", \"Washington\", \"Watonwan\",\r\n                             \"Wilkin\", \"Winona\", \"Wright\", \"Yellow Medicine\"),\r\n         Year == 2021, StateAbbr == \"MN\")\r\n\r\n\r\n# Clean census data\r\nCensusEstMN$CTYNAME <- gsub(\" County\", \"\", CensusEstMN$CTYNAME)\r\n\r\n\r\n# Population estimates for CHD in MN\r\nPopEst_CHDMN <- CensusEstMN |>\r\n  filter(YEAR == 3) |>\r\n  inner_join(Selected_Locations, by = c(\"CTYNAME\" = \"LocationName\")) |>\r\n  select(CTYNAME, Data_Value_Type, AGE18PLUS_TOT, Measure, Data_Value, High_Confidence_Limit, Low_Confidence_Limit)\r\n\r\n\r\n# Calculate crude and age-adjusted values\r\ncalc_aggregate_values <- function(df) {\r\n  df |>\r\n    mutate(Aggregate_Data_Value = Data_Value * AGE18PLUS_TOT / 100,\r\n           Aggregate_Low_Confidence_Limit = Low_Confidence_Limit * AGE18PLUS_TOT / 100,\r\n           Aggregate_High_Confidence_Limit = High_Confidence_Limit * AGE18PLUS_TOT / 100) |>\r\n    select(CTYNAME, Data_Value_Type, AGE18PLUS_TOT, Aggregate_High_Confidence_Limit,\r\n           Aggregate_Data_Value, Aggregate_Low_Confidence_Limit)\r\n}\r\n\r\n\r\nCHD_Crude21MN <- calc_aggregate_values(PopEst_CHDMN |> filter(Data_Value_Type == 'Crude prevalence'))\r\nCHD_Adj21MN <- calc_aggregate_values(PopEst_CHDMN |> filter(Data_Value_Type == 'Age-adjusted prevalence'))\r\nCHD_MN21 <- bind_rows(CHD_Adj21MN, CHD_Crude21MN)\r\n\r\n\r\n# User Interface --------------------------------------------------------------\r\nui <- dashboardPage(\r\n  dashboardHeader(\r\n    title = \"CDC Places to MN Regions\", \r\n    titleWidth = 400\r\n    #disable = TRUE #uncomment if the header should be hid\r\n  ),\r\n  \r\n  dashboardSidebar(\r\n    width = 350, #This makes the sidebar wider. However, the input boxes seem to have a set dimension resulting in long names still wrapping\r\n    \r\n    # Other input elements...\r\n    selectInput(\r\n      \"parGlobal_county\",\r\n      label = \"Select County of Interest\",\r\n      choices = sort(unique(mn_region_raw$County)),\r\n      selected = \"Aitkin\", #\"Kittson\"\r\n      width = 350\r\n    ),\r\n    \r\n    # Sidebar is required to have sub menus because it requires the tabName to reference\r\n    # By having sidebarMenu id, you can reference it and hide other filters with shinyjs \r\n    # The CHB and Region Filters are greyed out when on the Region & CHB Definitions\r\n    sidebarMenu(\r\n      menuItem(\"Home\", tabName = \"tn_homePage\"),\r\n      menuItem(\"Region & CHB Definitions\", tabName = \"tn_regionChbDefinations\"),\r\n      menuItem(\"Coronary Heart Disease\", tabName = \"tn_coronaryHeartDisease\")\r\n    )\r\n  ),\r\n  dashboardBody(\r\n    shinyjs::useShinyjs(), # Thank you Abby Stamm at MDH for suggesting to only call one function in a package rather then load entire package \r\n    tabItems(\r\n      tabItem(\r\n        tabName = \"tn_homePage\", # tabName is what ties the menuItem to the tabItem\r\n        tabsetPanel(\r\n          tabPanel(\r\n            \"Home Page\",\r\n            # Narrative section explaining the purpose of the dashboard\r\n            fluidRow(\r\n              column(\r\n                width = 12,\r\n                h1(\"Welcome to the CDC PLACES MN Region Dashboard\"),\r\n                h4(\"This Shiny application replicates the work represented \",\r\n                   tags$a(href=\"https://data.web.health.state.mn.us/web/mndata/\", \"here!\", target= \"_blank\")),\r\n                tags$h4(\"Before the CDC Places project, the CDC Behavioral Risk Factor Surveillance System BRFSS, allowed for state \r\n                    projected healthcare indicators. This process was not able to be applied to the county level. Now, with \r\n                    CDC Places counties can view some projected healthcare indicators. However, currently the CDC Places project \r\n                    does not show in an easy format aggregate county regions. By doing this project, I am not only going to help \r\n                    Quin County CHS, but other county regions in the state of MN or even the US.\"),\r\n                tags$h3(\"Those involved with this project:\"),\r\n                tags$h4(\"Emmanuel Fle Chea, MPH, Public Health Data Science, University of Minnesota School of Public Health\"),\r\n                tags$h4(\"Mr. Patrick Olson (Preceptor), Quin County Community Health Board, Community Resource Liaison/Associate/Researcher\"),\r\n              )\r\n            )\r\n          )\r\n        )\r\n      ),\r\n      tabItem(\r\n        tabName = \"tn_regionChbDefinations\",\r\n        fluidRow(\r\n          column(\r\n            width = 12,\r\n            tabsetPanel(\r\n              tabPanel(\r\n                \"Region/CHB\",\r\n                fluidRow(\r\n                  column(\r\n                    width = 12,\r\n                    # Narrative section explaining the purpose of the dashboard\r\n                    h3(HTML(\"Updating the Select County of Interest filter will highlight the county in <font color=red>red<\/font> while the Regions and Community Health Boards will remain in <b>bold<\/b>.\")),\r\n                    h3(\"For this tab, the Select SCHSAC Region and Select Community Health Board filters are greyed out because they do not execute any function on this tab.\"),\r\n                    h3(\"The purpose for this tab is to provide a quick reference for what counties fall under which region and Community Health Board.\"),\r\n                    tags$hr(style = \"border-top: 1px solid #ccc; margin-top: 20px; margin-bottom: 20px;\")\r\n                  )\r\n                ),\r\n                fluidRow(\r\n                  column(6, uiOutput(\"region_narrative\", style = \"font-size: 20px;\")),\r\n                  column(6, uiOutput(\"chb_narrative_01\", style = \"font-size: 20px;\"))\r\n                )\r\n              )\r\n            )\r\n          )\r\n        )\r\n      ),\r\n      tabItem(\r\n        tabName = \"tn_coronaryHeartDisease\",\r\n        tabsetPanel(\r\n          id = \"tpId_coronaryHeartDisease\",\r\n          tabPanel(\r\n            \"Adults>=18 CHD Exposure\",\r\n            fluidRow(\r\n              column(\r\n                width = 2,\r\n                selectInput(\r\n                  \"parLocal_leadYear\",\r\n                  label = \"Select Year\",\r\n                  choices = sort(unique(Selected_Locations$Year), decreasing = TRUE),\r\n                  selected = max(unique(Selected_Locations$Year))\r\n                ),\r\n                selectInput(\r\n                  \"par_leadStateRegionChb\",\r\n                  label = \"Select Comparison\",\r\n                  choices = c(\"All\", \"State\", \"Region\", \"Community Health Board\"),\r\n                  selected = \"All\",\r\n                  multiple = FALSE\r\n                )\r\n              ),\r\n              column(\r\n                width = 10,\r\n                box(\r\n                  title = \"Coronary Heart Disease Exposure Estimate\",\r\n                  status = \"primary\",\r\n                  solidHeader = TRUE,\r\n                  collapsible = TRUE,\r\n                  plotOutput(\"plot_chdEstimate\")\r\n                ),\r\n                box(\r\n                  title = \"Confidence Interval for Coronary Heart Disease Estimate\",\r\n                  status = \"primary\",\r\n                  solidHeader = TRUE,\r\n                  collapsible = TRUE,\r\n                  plotOutput(\"plot_confidenceInterval\")\r\n                )\r\n              )\r\n            )\r\n          )\r\n        )\r\n      )\r\n    )\r\n  )\r\n)\r\n\r\n# Server ----------------------------------------------------------------------\r\n\r\n# Region & County -----------------------\r\n\r\nserver <- function(input, output, session) {\r\n  observe({\r\n    updateSelectInput(\r\n      session,\r\n      \"parGlobal_region\",\r\n      choices = unique(mn_region_raw$RegionName)\r\n    )\r\n  })\r\n  \r\n  observe({\r\n    updateSelectInput(\r\n      session,\r\n      \"parGlobal_chb\",\r\n      choices = unique(chb_raw$CHBName)\r\n    )\r\n  })\r\n  \r\n  output$region_narrative <- renderUI({\r\n    filtered_region <- mn_region_raw %>%\r\n      filter(County == input$parGlobal_county)\r\n    HTML(\r\n      paste0(\r\n        \"<b>\", unique(filtered_region$RegionName), \" Region<\/b> is made up of the following counties: \",\r\n        paste(unique(filtered_region$County), collapse = \", \"), \".\"\r\n      )\r\n    )\r\n  })\r\n  \r\n  output$chb_narrative_01 <- renderUI({\r\n    filtered_chb <- chb_raw %>%\r\n      filter(County == input$parGlobal_county)\r\n    HTML(\r\n      paste0(\r\n        \"<b>\", unique(filtered_chb$CHBName), \" Community Health Board<\/b> includes: \",\r\n        paste(unique(filtered_chb$County), collapse = \", \"), \".\"\r\n      )\r\n    )\r\n  })\r\n  \r\n  # Reactive Data\r\n  reactive_CHD_data <- reactive({\r\n    CHD_MN21 %>% filter(CTYNAME == input$parGlobal_county)\r\n  })\r\n  \r\n  output$plot_chdEstimate <- renderPlot({\r\n    data <- reactive_CHD_data()\r\n    ggplot(data, aes(x = CTYNAME, y = Aggregate_Data_Value, fill = Data_Value_Type)) +\r\n      geom_bar(stat = \"identity\", position = \"dodge\") +\r\n      labs(title = \"Coronary Heart Disease Exposure Estimate\", x = \"County\", y = \"Estimate\")\r\n  })\r\n  \r\n  output$plot_confidenceInterval <- renderPlot({\r\n    data <- reactive_CHD_data()\r\n    ggplot(data, aes(x = CTYNAME, y = Aggregate_Data_Value, color = Data_Value_Type)) +\r\n      geom_errorbar(aes(ymin = Aggregate_Low_Confidence_Limit, ymax = Aggregate_High_Confidence_Limit), width = 0.2) +\r\n      labs(title = \"Confidence Interval for Coronary Heart Disease Estimate\", x = \"County\", y = \"Estimate\")\r\n  })\r\n}\r\n\r\n# App Initialization ----------------------------------------------------------\r\nshinyApp(ui = ui, server = server)\r\n","type":"text"}]
